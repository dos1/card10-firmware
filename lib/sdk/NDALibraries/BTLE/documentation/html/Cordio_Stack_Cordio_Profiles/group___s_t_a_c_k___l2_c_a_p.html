<!--
  Copyright (c) 2013-2018 Arm Ltd. All Rights Reserved.
  Arm Limited confidential and proprietary.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Logical Link Control and Adaptation Protocol (L2CAP)</title>
<title>Cordio Stack and Cordio Profiles: Logical Link Control and Adaptation Protocol (L2CAP)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="DoxygenStyleSheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo">&#160;<img alt="Logo" src="Arm_Cordio.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">&#160;&#160;&#160;Cordio Stack and Cordio Profiles
   &#160;<span id="projectnumber">r2p3-02rel0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="BLEnav" class="tabs1">
    <ol id="Tabs" class="tablist">
      <script type="text/javascript">
        <!--
        writeComponentTabs.call(this);
        //-->
      </script>
    </ol>
</div>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li class="current"><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___s_t_a_c_k___l2_c_a_p.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Content</a>  </div>
  <div class="headertitle">
<div class="title">Logical Link Control and Adaptation Protocol (L2CAP)<div class="ingroups"><a class="el" href="group___b_l_e___s_t_a_c_k.html">ble-stack</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Content</h2></td></tr>
<tr class="memitem:group___s_t_a_c_k___l2_c_a_p___a_p_i"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_t_a_c_k___l2_c_a_p___a_p_i.html">L2CAP API</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Description</h2>
<h1><a class="anchor" id="L2CAP_INTRO"></a>
Introduction</h1>
<div class="image">
<img src="diagram_l2cap.png" alt="diagram_l2cap.png"/>
<div class="caption">
Figure 1. BLE Stack: L2CAP</div></div>
<p> The L2C subsystem implements the LE L2CAP protocol. It is a substantially scaled-down version of regular Bluetooth L2CAP.<br />
<br />
 L2C interfaces to HCI to send and receive ACL packets. The ATT and SMP protocol layers interface to L2C to send and receive L2CAP packets. L2C also interfaces to DM to perform the L2CAP connection update procedure.<br />
<br />
 In the TX data path, the main function of L2C is building L2CAP packets and sending them to HCI. L2C also implements flow control for the TX data path. L2C may in the future implement admission control in the TX path, allowing more optimal buffer sharing between multiple simultaneous links.<br />
<br />
 In the RX data path, its main function is receiving packets from HCI and routing them to either SMP or ATT. L2C also implements the connection parameter update procedure.<br />
<br />
 For full API, see <a class="el" href="group___s_t_a_c_k___l2_c_a_p___a_p_i.html">L2CAP API</a></p>
<h1><a class="anchor" id="L2CAP_SUBSYS"></a>
Subsystem Architecture</h1>
<div class="image">
<img src="diagram_l2capss.png" alt="diagram_l2capss.png"/>
<div class="caption">
Figure 2. L2CAP Subsystem</div></div>
<p> Module l2c_api contains the API. Module l2c_main contains the main API function implementation, main event handler, and functions for processing packets. Module l2c_master contains API functions and other functions used only when operating as an LE master. Module l2c_slave contains API functions and other functions used only when operating as an LE slave. Module lcc_coc contains functions for L2CAP Connection Oriented Channels.</p>
<h1><a class="anchor" id="L2CAP_USAGE"></a>
Usage Scenarios</h1>
<p>This section describes example scenarios for initialization and connection.</p>
<h2><a class="anchor" id="L2CAP_USAGE_INIT"></a>
Initialization</h2>
<p>Figure 2 shows the initialization process. In this example, the system supports operation as both a master and a slave so <a class="el" href="group___s_t_a_c_k___l2_c_a_p___a_p_i.html#ga857e077cf087d0d4ee6a38104b2c9f17" title="Initialize L2C for operation as a Bluetooth LE master. ">L2cMasterInit()</a> and <a class="el" href="group___s_t_a_c_k___l2_c_a_p___a_p_i.html#gaf8c3cdfe93337f59771103fc669d4da9" title="Initialize L2C for operation as a Bluetooth LE slave. ">L2cSlaveInit()</a> are called. Then function <a class="el" href="group___s_t_a_c_k___e_v_e_n_t.html#ga8ed5ec1a676fe49ad82e31949dc30656" title="Event handler initialization function for L2C when operating as a slave. ">L2cSlaveHandlerInit()</a> is called after <a class="el" href="group___s_t_a_c_k___e_v_e_n_t.html#ga4ff12df9b0de16e4806b9fd2694cd9a3" title="The WSF event handler for L2C when operating as a slave. ">L2cSlaveHandler()</a> is set up in the WSF OS implementation.</p>
<div class="image">
<img src="operation_l2cap_init.png" alt="operation_l2cap_init.png"/>
<div class="caption">
Figure 3. Initialization</div></div>
 <h2><a class="anchor" id="L2CAP_USAGE_DATAPATH"></a>
Data Path</h2>
<p>Figure 3 shows the operation of the data path with ATT shown as an example L2C client. ATT calls <a class="el" href="group___s_t_a_c_k___l2_c_a_p___a_p_i.html#ga8343a287655993dbe071d166a410a328" title="Send an L2CAP data packet on the given CID. ">L2cDataReq()</a> to send a packet to L2C. Then L2C calls <a class="el" href="group___s_t_a_c_k___h_c_i___a_c_l___a_p_i.html#gaeba76cd2310f3de5f92aef2f55e38d38" title="Send ACL Data from the stack to HCI. ">HciSendAclData()</a> to send the packet to HCI. In the receive direction, HCI calls HciAclDataCback() to send a packet to L2C. L2C calls ATT callback function attDataCback() to send the packet to ATT.</p>
<div class="image">
<img src="operation_l2cap_datapath.png" alt="operation_l2cap_datapath.png"/>
<div class="caption">
Figure 4. Data Path</div></div>
 <h2><a class="anchor" id="L2CAP_USAGE_CONNPARAMUPDATE"></a>
Connection Parameter Update</h2>
<p>Figure 4 shows a connection parameter update procedure with the stack operating as a slave. DM calls <a class="el" href="group___s_t_a_c_k___l2_c_a_p___a_p_i.html#ga09a1524ad803a9472589264993a695e9" title="For internal use only. This function is called by DM to send an L2CAP connection update request...">L2cDmConnUpdateReq()</a> to initiate the process. L2C builds and sends an L2CAP Connection Parameter Update Request. The peer device receives the request and initiates a connection update procedure. When the procedure completes, an HCI LE Connection Update Complete Event is sent from HCI to DM. Then the L2CAP Connection Parameter Update Response is received from the peer and L2C calls <a class="el" href="group___s_t_a_c_k___d_m___a_p_i.html#ga341fcfb263755395808ab01eec63b0f4" title="For internal use only. L2C calls this function to send the result of an L2CAP connection update respo...">DmL2cConnUpdateCnf()</a>.</p>
<div class="image">
<img src="operation_l2cap_connparamupdate.png" alt="operation_l2cap_connparamupdate.png"/>
<div class="caption">
Figure 5. Connection Parameter Update</div></div>
<p><br />
<br />
</p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
<ul>
<table width="100%">
    <tr>
        <td align="left" valign="middle">Copyright &copy; 2017-2018 Arm Ltd. All rights reserved.</td>
        <td align="center" valign="middle">Arm Confidential</td>
        <td align="right" valign="middle">Cordio Stack and Cordio Profiles</td>
    </tr>
</table>
</ul>
</div>
</body>
</html>
